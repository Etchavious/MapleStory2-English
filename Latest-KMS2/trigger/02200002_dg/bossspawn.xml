<?xml version="1.0" encoding="utf-8"?>
<ms2>
	<state name="시작대기중">
		<condition name="CheckUser">
			<transition state="기본셋팅"/>
		</condition>
	</state>
	<state name="기본셋팅"> 
		<onEnter>
			<!-- 이펙트 초기화(OFF) -->
			<action name="SetEffect" arg1="20001" arg2="0"/>
			<action name="포탈을설정한다" arg1="1" arg2="0" arg3="0" arg4="0"/>
			<action name="포탈을설정한다" arg1="2" arg2="0" arg3="0" arg4="0"/>
			<!-- 조명 설정(어두움) -->
			<action name="SetDirectionalLight" arg1="0,0,0" arg2="0,0,0"/>
			<action name="SetAmbientLight" arg1="107,100,89"/>	
		</onEnter>  			
		<condition name="유저를감지했으면" arg1="99999999">
			<transition state="보스등장"/>
		</condition>
	</state>
	
	<state name="보스등장">
		<onEnter>
			<action name="DungeonEnableGiveUp" isEnable="1" />		
			<action name="몬스터를생성한다" arg1="2000" arg2="0"/>
			<!-- arg2="0" 을 넣으면 보스 등장하자마자 바로 공격 상태가 되는 것을 막을 수 있음-->
			<!-- 이펙트 활성화(ON) -->
			<action name="SetNpcRotation" arg1="2000" arg2="270" />
			<!-- 등장연출을 위한 보스 축소 -->
			<action name="버프를걸어준다" arg1="2000" arg2="44100004" arg3="1" arg4="1" arg5="1"/>
			<action name="SetEffect" arg1="20001" arg2="1"/>
			<!-- 조명 설정(밝음) -->
			<action name="SetDirectionalLight" arg1="255,247,239" arg2="255,255,255"/>
			<action name="SetAmbientLight" arg1="214,200,179"/>	
		</onEnter>
		<condition name="WaitTick" waitTick="200" >
			<transition state="등장연출" /> 
		</condition>
	</state>
	
	<state name="등장연출">
		<onEnter>
			<action name="버프를걸어준다" arg1="2000" arg2="44100004" arg3="2" arg4="1" arg5="1"/>
		</onEnter>
		<condition name="WaitTick" waitTick="1000" > 
			<transition state="전투정보초기화" />
		</condition>
	</state>

	<state name="전투정보초기화">
		<onEnter>
			<action name="NpcRemoveAdditionalEffect" spawnPointID="2000" additionalEffect="44100004" />
			<action name="DungeonEnableGiveUp" isEnable="1" />
			<action name="이벤트UI를설정한다" arg1="1" arg2="$02000384_BF__BARRICADE__0$" arg3="3000" />
		</onEnter>
		<condition name="WaitTick" waitTick="30000">
			<transition state="유저카운트"/>
		</condition>
	</state>
		
	<state name="전투진행중">
		<condition name="UserValue" key="BattleEnd" value="1">  
			<transition state="클리어처리"/>
		</condition>
		<condition name="DungeonTimeOut" >						
			<transition state="던전실패" />
		</condition>
		<condition name="DungeonCheckState" checkState="Fail">
			<transition state="던전실패" />
		</condition>
	</state>

	<state name="유저카운트">
		<condition name="CheckUserCount" checkCount="1">
			<transition state="유저카운트설정1"/>
		</condition>
		<condition name="CheckUserCount" checkCount="2">
			<transition state="유저카운트설정2"/>
		</condition>
		<condition name="CheckUserCount" checkCount="3">
			<transition state="유저카운트설정3"/>
		</condition>
		<condition name="CheckUserCount" checkCount="4">
			<transition state="유저카운트설정4"/>
		</condition>
		<condition name="CheckUserCount" checkCount="5">
			<transition state="유저카운트설정5"/>
		</condition>
		<condition name="CheckUserCount" checkCount="6">
			<transition state="유저카운트설정6"/>
		</condition>
	</state>
	
	<state name="유저카운트설정1">
		<onEnter>
			<action name="DebugString" string="USER COUNT 1"/>
			<action name="SetAiExtraData" key="userCount" value="1" boxID="0" isModify="false"/>
		</onEnter>
		<condition name="무조건" > 
			<transition state="전투진행중" />
		</condition>
	</state>
	<state name="유저카운트설정2">
		<onEnter>
			<action name="DebugString" string="USER COUNT 2"/>		
			<action name="SetAiExtraData" key="userCount" value="2" boxID="0" isModify="false"/>
		</onEnter>
		<condition name="무조건" > 
			<transition state="전투진행중" />
		</condition>
	</state>
	<state name="유저카운트설정3">
		<onEnter>
			<action name="DebugString" string="USER COUNT 3"/>
			<action name="SetAiExtraData" key="userCount" value="3" boxID="0" isModify="false"/>
		</onEnter>
		<condition name="무조건" > 
			<transition state="전투진행중" />
		</condition>
	</state>
	<state name="유저카운트설정4">
		<onEnter>
			<action name="DebugString" string="USER COUNT 4"/>		
			<action name="SetAiExtraData" key="userCount" value="4" boxID="0" isModify="false"/>
		</onEnter>
		<condition name="무조건" > 
			<transition state="전투진행중" />
		</condition>
	</state>
	<state name="유저카운트설정5">
		<onEnter>
			<action name="DebugString" string="USER COUNT 5"/>
			<action name="SetAiExtraData" key="userCount" value="5" boxID="0" isModify="false"/>
		</onEnter>
		<condition name="무조건" > 
			<transition state="전투진행중" />
		</condition>
	</state>
	<state name="유저카운트설정6">
		<onEnter>
			<action name="DebugString" string="USER COUNT 6"/>
			<action name="SetAiExtraData" key="userCount" value="6" boxID="0" isModify="false"/>
		</onEnter>
		<condition name="무조건" > 
			<transition state="전투진행중" />
		</condition>
	</state>
	
	<state name="클리어처리">
		<onEnter>
			<action name="메쉬를설정한다" arg1="4000" arg2="0" arg3="0" arg4="0" arg5="10" />
		</onEnter>
		<condition name="WaitTick" waitTick="4000" >
			<action name="DungeonClear" /> 
			<transition state="게임종료" />
		</condition>
	</state>
	
	<state name="던전실패">
		<onEnter>
			<action name="메쉬를설정한다" arg1="4000" arg2="0" arg3="0" arg4="0" arg5="10" />
			<action name="DungeonSetEndTime" />  <!--시간 기능 종료시킴, 이 기능 잘 작동시키려면 DungeonRoom.xlsx 의 제한 시간 만료 시(isExpireTimeOut) 빈칸 설정 해야 함  -->		
			<action name="DungeonCloseTimer" />
		</onEnter>		 
		<condition name="WaitTick" waitTick="1000" > 
			<action name="DungeonFail" /> 
			<transition state="게임종료" />
		</condition>
	</state>
	
	<state name="게임종료">
		<onEnter>
			<action name="몬스터소멸시킨다" arg1="all" />
			<action name="메쉬를설정한다" arg1="1031-1046" arg2="0" />
			<action name="포탈을설정한다" arg1="3" arg2="1" arg3="1" arg4="1"/>
			<action name="포탈을설정한다" arg1="4" arg2="1" arg3="1" arg4="1"/>
			<action name="DungeonEnableGiveUp" isEnable="0" />
		</onEnter>
		<condition name="WaitTick" waitTick="2000" > 
			<action name="LookCenterCameraRadian" on="1" radian="3.927" />
      		<transition state="끝" />
		</condition>		
	</state>
	
  <state name="끝">
	<onEnter>
		<!-- 사망시에 드럼롤이 소환될 경우를 대비해 한번더 소멸 요청 -->
		<action name="몬스터소멸시킨다" arg1="all" />
	</onEnter>
  </state>
</ms2>